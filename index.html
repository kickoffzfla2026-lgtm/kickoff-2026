<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Acceso</title>
  <style>
    body{font-family:system-ui,sans-serif;display:flex;min-height:100vh;align-items:center;justify-content:center;background:#0b0f1a;color:#e8ecff;padding:24px}
    .wrap{width:min(980px,96vw)}
    .card{width:min(420px,92vw);background:#121a2b;padding:24px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);margin:0 auto}
    h1{font-size:20px;margin:0 0 12px}
    p{opacity:.85;margin:0 0 16px}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #2a3553;background:#0c1326;color:#e8ecff;font-size:16px;outline:none}
    button{width:100%;margin-top:12px;padding:12px 14px;border-radius:12px;border:0;background:#4b7dff;color:#fff;font-size:16px;cursor:pointer}
    button:hover{filter:brightness(1.05)}
    .msg{margin-top:12px;min-height:22px;color:#ffb3b3}
    .hint{margin-top:12px;font-size:12px;opacity:.6}

    #gameWrap{display:none;margin:18px auto 0;background:#121a2b;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:18px}
    .gameTop{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .miniBtn{width:auto;margin:0;padding:10px 12px;border-radius:12px;background:transparent;border:1px solid #2a3553;color:#e8ecff;cursor:pointer}
    .miniBtn:hover{background:#0c1326}

    canvas{width:100%;height:auto;border-radius:16px;background:#0c1326;border:1px solid #2a3553;touch-action:manipulation}
    .ok{color:#b7ffc9}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Paso 1: C√≥digo -->
    <div class="card" id="codeCard">
      <h1>C√≥digo de Agenteüïµüèª‚Äç‚ôÇÔ∏è</h1>
      <p>Ingresa el c√≥digo para continuar.</p>
      <input id="code" type="password" placeholder="C√≥digo" autocomplete="off" />
      <button id="btn">Entrar</button>
      <div class="msg" id="msg"></div>
      <div class="hint">Si aciertas, juegas 10 segundos: salta 3 barreras.</div>
    </div>

    <!-- Paso 2: Juego -->
    <div id="gameWrap">
      <div class="gameTop">
        <div>
          <div style="font-weight:600">Misi√≥n: salta 3 barreras</div>
          <div class="hint" style="margin:6px 0 0">Espacio / clic / toque para saltar.</div>
        </div>
        <button class="miniBtn" id="restartBtn">Reiniciar</button>
      </div>

      <div style="margin-top:12px" class="hint">
        Barreras superadas: <span id="count">0</span>/3
        <span id="status" style="margin-left:10px"></span>
      </div>

      <div style="margin-top:12px">
        <canvas id="cv" width="900" height="260"></canvas>
      </div>
    </div>
  </div>

  <script>
    // ‚úÖ C√≥digos v√°lidos
    const CODIGOS_VALIDOS = ["2201", "2095", "1883", "0001"];

    // ‚úÖ Enlace Drive a abrir al ganar
    const ENLACE_DRIVE = "https://drive.google.com/file/d/1cfL9S6FOY2NseUfphpPfO4r54i-hxTw0/view?usp=sharing";

    // ====== UI ======
    const codeCard = document.getElementById("codeCard");
    const input = document.getElementById("code");
    const msg = document.getElementById("msg");
    const btn = document.getElementById("btn");

    const gameWrap = document.getElementById("gameWrap");
    const restartBtn = document.getElementById("restartBtn");
    const countEl = document.getElementById("count");
    const statusEl = document.getElementById("status");

    const cv = document.getElementById("cv");
    const ctx = cv.getContext("2d");

    // ====== Abrir Drive grande ======
    function abrirDrivePantallaGrande(){
      const w = screen.width, h = screen.height;
      const features = `toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=${w},height=${h},top=0,left=0`;
      const win = window.open(ENLACE_DRIVE, "_blank", features);
      if (!win) window.location.href = ENLACE_DRIVE;
    }

    // ====== Juego ======
    let running = false;
    let won = false;
    let passed = 0;

    const groundY = 210;
    const gravity = 0.9;

    const spy = {
      x: 110,
      y: groundY,
      w: 28,
      h: 36,
      vy: 0,
      jumping: false
    };

    let speed = 6.5;
    let spawnTimer = 0;
    let nextSpawn = 70;

    const obstacles = [];

    function resetGame(){
      running = true;
      won = false;
      passed = 0;
      speed = 6.5;
      spawnTimer = 0;
      nextSpawn = 70;

      obstacles.length = 0;
      spy.y = groundY;
      spy.vy = 0;
      spy.jumping = false;

      countEl.textContent = "0";
      statusEl.textContent = "";
      statusEl.className = "";
    }

    function jump(){
      if (!running || won) return;
      if (!spy.jumping) {
        spy.vy = -15;
        spy.jumping = true;
      }
    }

    function spawnObstacle(){
      // Barreras simples (rect√°ngulos)
      const h = 28 + Math.floor(Math.random()*18);
      obstacles.push({
        x: cv.width + 10,
        y: groundY,
        w: 18 + Math.floor(Math.random()*12),
        h
      });
    }

    function collide(a, b){
      // a = spy, b = obstacle (desde suelo hacia arriba)
      const ax1 = a.x, ax2 = a.x + a.w;
      const ay1 = a.y - a.h, ay2 = a.y;
      const bx1 = b.x, bx2 = b.x + b.w;
      const by1 = b.y - b.h, by2 = b.y;
      return ax1 < bx2 && ax2 > bx1 && ay1 < by2 && ay2 > by1;
    }

    function update(){
      // f√≠sica salto
      spy.vy += gravity;
      spy.y += spy.vy;

      if (spy.y >= groundY) {
        spy.y = groundY;
        spy.vy = 0;
        spy.jumping = false;
      }

      // spawns
      spawnTimer++;
      if (spawnTimer >= nextSpawn) {
        spawnTimer = 0;
        nextSpawn = 55 + Math.floor(Math.random()*45);
        spawnObstacle();
      }

      // mover obst√°culos + colisi√≥n + contar pasados
      for (let i = obstacles.length - 1; i >= 0; i--){
        const o = obstacles[i];
        o.x -= speed;

        if (collide(spy, o)) {
          running = false;
          statusEl.textContent = "Fallaste üòÖ (reinicia)";
          statusEl.className = "";
        }

        // si pas√≥ por completo el esp√≠a
        if (!o.passed && o.x + o.w < spy.x) {
          o.passed = true;
          passed++;
          countEl.textContent = String(passed);

          // acelera un poquito
          speed += 0.25;

          if (passed >= 3 && !won) {
            won = true;
            running = false;
            statusEl.textContent = "¬°Misi√≥n cumplida! ‚úÖ Abriendo‚Ä¶";
            statusEl.className = "ok";
            // abrir Drive (por ser tras interacci√≥n, suele permitir pop-up)
            abrirDrivePantallaGrande();
          }
        }

        // limpiar fuera de pantalla
        if (o.x + o.w < -40) obstacles.splice(i, 1);
      }
    }

    function draw(){
      ctx.clearRect(0,0,cv.width,cv.height);

      // suelo
      ctx.fillRect(40, groundY, cv.width-80, 3);

      // "esp√≠a" (mu√±eco simple)
      // cuerpo
      ctx.fillRect(spy.x, spy.y - spy.h, spy.w, spy.h);
      // ‚Äúgafas‚Äù (detalle)
      ctx.clearRect(spy.x + 6, spy.y - 26, 16, 6);

      // obst√°culos
      for (const o of obstacles){
        ctx.fillRect(o.x, o.y - o.h, o.w, o.h);
      }

      // texto ayuda
      ctx.font = "16px system-ui";
      ctx.fillText("Espacio / clic / toque para saltar", 60, 50);
    }

    function loop(){
      if (running) update();
      draw();
      requestAnimationFrame(loop);
    }

    // ====== C√≥digo ‚Üí Juego ======
    function showGame(){
      codeCard.style.display = "none";
      gameWrap.style.display = "block";
      resetGame();
    }

    function checkCode(){
      const code = input.value.trim();
      if (CODIGOS_VALIDOS.includes(code)) {
        msg.textContent = "";
        showGame();
      } else {
        msg.textContent = "C√≥digo incorrecto. Intente de nuevo.";
        input.value = "";
        input.focus();
      }
    }

    btn.addEventListener("click", checkCode);
    input.addEventListener("keydown",(e)=>{ if(e.key==="Enter") checkCode(); });

    // Controles: espacio, clic, tap
    window.addEventListener("keydown",(e)=>{
      if (e.code === "Space") { e.preventDefault(); jump(); }
    });
    cv.addEventListener("pointerdown",(e)=>{ e.preventDefault(); jump(); });
    gameWrap.addEventListener("click",(e)=>{
      // si clic fuera del canvas, tambi√©n salta (opcional)
      if (e.target.id !== "restartBtn") jump();
    });

    restartBtn.addEventListener("click", ()=>{
      statusEl.textContent = "";
      statusEl.className = "";
      resetGame();
    });

    // iniciar render
    loop();
  </script>
</body>
</html>
